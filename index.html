<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Drunk Simulator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400..700&family=Roboto:wght@100;300;400;500;700;900&family=Open+Sans:wght@300;400;500;600;700;800&family=Noto+Sans+JP:wght@100;300;400;500;700;900&family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #000000;
        }
        body {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #game-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #game-container canvas {
            display: block;
        }

        /* On desktop, scale down game to fit inside phone mockup */
        @media (min-width: 1024px) {
            #game-container {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 443px;
                height: 923px;
                padding: 0;
                margin-top: 0;
            }

            #game-container canvas {
                width: 443px !important;
                height: 923px !important;
                border-radius: 40px; /* Match iPhone screen corners */
                overflow: hidden;
            }
        }

        /* iPhone Mockup Overlay - Desktop Only */
        #phone-mockup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 460px;
            height: 940px;
            background-image: url('https://www.webmobilefirst.com/en/mockups/iPhone_14_plus/iPhone_14_plus_black_1179x2556.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            pointer-events: none;
            z-index: 10000;
            display: none;
            filter: drop-shadow(0 0 30px rgba(255, 255, 255, 0.8))
                    drop-shadow(0 0 60px rgba(255, 255, 255, 0.5))
                    drop-shadow(0 0 100px rgba(255, 255, 255, 0.3));
            border: 3px solid rgba(255, 255, 255, 0.6);
            border-radius: 50px;
        }

        /* Container wrapper for proper centering */
        #phone-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none;
            z-index: 10000;
        }

        /* Show mockup only on desktop */
        @media (min-width: 1024px) {
            #phone-mockup {
                display: block;
            }
        }

        /* Map Editor Container */
        #editor-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #222;
            z-index: 30000;
            display: none;
        }

        #editor-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body>
    <div id="phone-wrapper">
        <div id="phone-mockup"></div>
    </div>
    <div id="game-container"></div>

    <!-- Map Editor Container (iframe) -->
    <div id="editor-container">
        <iframe id="editor-frame" src="map-editor.html"></iframe>
    </div>

    <!-- Camera Scanner Overlay -->
    <div id="camera-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); z-index: 20000; flex-direction: column; justify-content: center; align-items: center;">
        <div style="position: relative; max-width: 90%; max-height: 80vh;">
            <video id="camera-video" autoplay playsinline style="width: 100%; height: auto; border-radius: 10px;"></video>
            <canvas id="camera-canvas" style="display: none;"></canvas>
            <div id="scan-status" style="color: #fff; font-family: 'Pixelify Sans', sans-serif; font-size: 20px; margin-top: 20px; text-align: center;">ðŸ“¸ Point camera at QR code...</div>
        </div>
        <button id="close-camera" style="margin-top: 30px; padding: 15px 40px; background: #f00; color: #fff; border: none; border-radius: 5px; font-family: 'Pixelify Sans', sans-serif; font-size: 24px; cursor: pointer; font-weight: bold;">âœ• Close</button>
    </div>

    <script>
        // Global functions to toggle between game and editor
        window.showEditor = function() {
            document.getElementById('editor-container').style.display = 'block';
            document.getElementById('game-container').style.display = 'none';
            document.getElementById('phone-wrapper').style.display = 'none';
        };

        window.hideEditor = function() {
            document.getElementById('editor-container').style.display = 'none';
            document.getElementById('game-container').style.display = 'flex';
            document.getElementById('phone-wrapper').style.display = 'flex';
        };

        // Start game with map from editor
        window.startGameWithMap = function(mapData) {
            // Hide editor, show game
            window.hideEditor();

            // Store map data
            localStorage.setItem('scannedMap', mapData);

            // Get the Phaser game instance and restart the scene
            // The game will be available after main.ts loads
            setTimeout(() => {
                const game = window.phaserGame;
                if (game && game.scene) {
                    // Stop title scene and start game scene with map
                    game.scene.stop('TitleScene');
                    game.scene.start('GameScene', { scannedMapData: mapData });
                } else {
                    console.error('Game not ready yet');
                }
            }, 100);
        };
    </script>

    <script type="module" src="/src/main.ts"></script>
</body>
</html>
